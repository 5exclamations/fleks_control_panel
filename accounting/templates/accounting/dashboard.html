{% extends "base.html" %}

{% block title %}Панель управления{% endblock %}

{% block content %}
    <h1>Панель управления Психологического Центра</h1>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="container">

        <div class="form-card">
            <h2>Провести выплату сотруднику</h2>
            <form action="{% url 'dashboard' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="action_type" value="payout">

                <div>
                    <label for="worker_payout">Сотрудник:</label>
                    <select id="worker_payout" name="worker_id" required>
                        <option value="">--- Выберите сотрудника ---</option>
                        {% for worker in workers %}
                            <option value="{{ worker.id }}">{{ worker.user.username }} (Баланс: {{ worker.balance }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label for="payout_amount">Сумма выплаты:</label>
                    <input type="number" id="payout_amount" name="payout_amount" step="0.01" required>
                </div>

                <button type="submit" style="background: #dc3545;">Выплатить</button>
            </form>
        </div>

        <div class="form-card">
            <h2>Провести сеанс</h2>
            <form action="{% url 'dashboard' %}" method="POST">
                {% csrf_token %}

                <input type="hidden" name="action_type" value="process_session">

                <div>
                    <label for="client_session">Клиент:</label>
                    <select id="client_session" name="client_id" required>
                        <option value="">--- Выберите клиента ---</option>
                        {% for client in clients %}
                            <option value="{{ client.id }}">{{ client.full_name }} (Баланс: {{ client.balance }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label for="worker_session">Сотрудник:</label>
                    <select id="worker_session" name="worker_id" required>
                        <option value="">--- Выберите сотрудника ---</option>
                        {% for worker in workers %}
                            <option value="{{ worker.id }}">{{ worker.user.username }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label for="session_cost">Стоимость сеанса:</label>
                    <input type="number" id="session_cost" name="session_cost" step="0.01" required>
                </div>

                <button type="submit">Провести оплату и напечатать чек</button>
            </form>
        </div>

        <div class="form-card">
            <h2>Пополнить баланс клиента</h2>
            <form action="{% url 'dashboard' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="action_type" value="deposit">

                <div>
                    <label for="client_deposit">Клиент:</label>
                    <select id="client_deposit" name="client_id" required>
                        <option value="">--- Выберите клиента ---</option>
                        {% for client in clients %}
                            <option value="{{ client.id }}">{{ client.full_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label for="amount">Сумма пополнения:</label>
                    <input type="number" id="amount" name="deposit_amount" step="0.01" required>
                </div>

                <button type="submit">Пополнить</button>
            </form>
        </div>

    </div>
{% endblock %}